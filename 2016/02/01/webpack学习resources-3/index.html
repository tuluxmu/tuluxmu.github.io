<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="webpack-howto
Goal of this guide
This is a cookbook of how to get things done with webpack. This includes most things we use at Instagram and nothing we don’t use.
My advice: start with this as your w">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack学习resources-3">
<meta property="og:url" content="http://yoursite.com/2016/02/01/webpack学习resources-3/index.html">
<meta property="og:site_name" content="Lucy's Blog">
<meta property="og:description" content="webpack-howto
Goal of this guide
This is a cookbook of how to get things done with webpack. This includes most things we use at Instagram and nothing we don’t use.
My advice: start with this as your w">
<meta property="og:updated_time" content="2016-02-01T03:11:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="webpack学习resources-3">
<meta name="twitter:description" content="webpack-howto
Goal of this guide
This is a cookbook of how to get things done with webpack. This includes most things we use at Instagram and nothing we don’t use.
My advice: start with this as your w">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> webpack学习resources-3 | Lucy's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?your-analytics-id";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lucy's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Stay Hungry</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
      
        <li class="menu-item menu-item-search">
          <a href="#" class="st-search-show-outputs">
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'your-swiftype-key','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                webpack学习resources-3
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-01T11:08:34+08:00" content="2016-02-01">
              2016-02-01
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/01/webpack学习resources-3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/01/webpack学习resources-3/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>webpack-howto</p>
<p>Goal of this guide</p>
<p>This is a cookbook of how to get things done with webpack. This includes most things we use at Instagram and nothing we don’t use.</p>
<p>My advice: start with this as your webpack docs, then look at the official docs for clarification.</p>
<p>Prerequisites</p>
<ul>
<li>You know browserify, RequireJS or something similar</li>
<li>You see the value in:<ul>
<li>Bundle splitting</li>
<li>Async loading</li>
<li>Packaging static assets like images and CSS</li>
</ul>
</li>
</ul>
<ol>
<li>Why webpack?</li>
</ol>
<ul>
<li><p>It’s like browserify but can split your app into multiple files. If you have multiple pages in a single-page app, the user only downloads code for just that page. If they go to another page, they don’t redownload common code.</p>
</li>
<li><p>It often replaces grunt or gulp because it can build and bundle CSS, preprocessed CSS, compile-to-JS languages and images, among other things.</p>
</li>
</ul>
<p>It supports AMD and CommonJS, among other module systems (Angular, ES6). If you don’t know what to use, use CommonJS.</p>
<ol>
<li>Webpack for Browserify people</li>
</ol>
<p>These are equivalent:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">browserify main.js &#62; bundle.js&#10;&#10;&#10;&#10;webpack main.js bundle.js</span><br></pre></td></tr></table></figure>
<p>However, webpack is more powerful than Browserify, so you generally want to make a webpack.config.js to keep things organized:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// webpack.config.js&#10;module.exports = &#123;&#10;  entry: &#39;./main.js&#39;,&#10;  output: &#123;&#10;    filename: &#39;bundle.js&#39;&#10;  &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>This is just JS, so feel free to put Real Code in there.</p>
<ol>
<li>How to invoke webpack</li>
</ol>
<p>Switch to the directory containing webpack.config.js and run:</p>
<ul>
<li>webpack for building once for development</li>
<li>webpack -p for building once for production (minification)</li>
<li>webpack –watch for continuous incremental build in development (fast!)</li>
<li>webpack -d to include source maps</li>
</ul>
<ol>
<li>Compile-to-JS languages</li>
</ol>
<p>webpack’s equivalent of browserify transforms and RequireJS plugins is a loader. Here’s how you can teach webpack to load CoffeeScript and Facebook JSX+ES6 support (you must npm install babel-loader coffee-loader):</p>
<p>See also the babel-loader installation instructions for additional dependencies (tl;dr run npm install babel-core babel-preset-es2015 babel-preset-react).</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// webpack.config.js&#10;module.exports = &#123;&#10;  entry: &#39;./main.js&#39;,&#10;  output: &#123;&#10;    filename: &#39;bundle.js&#39;&#10;  &#125;,&#10;  module: &#123;&#10;    loaders: [&#10;      &#123; test: /\.coffee$/, loader: &#39;coffee-loader&#39; &#125;,&#10;      &#123;&#10;        test: /\.js$/,&#10;        loader: &#39;babel-loader&#39;,&#10;        query: &#123;&#10;          presets: [&#39;es2015&#39;, &#39;react&#39;]&#10;        &#125;&#10;      &#125;&#10;    ]&#10;  &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>To enable requiring files without specifying the extension, you must add a resolve.extensions parameter specifying which files webpack searches for:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// webpack.config.js&#10;module.exports = &#123;&#10;  entry: &#39;./main.js&#39;,&#10;  output: &#123;&#10;    filename: &#39;bundle.js&#39;&#10;  &#125;,&#10;  module: &#123;&#10;    loaders: [&#10;      &#123; test: /\.coffee$/, loader: &#39;coffee-loader&#39; &#125;,&#10;      &#123;&#10;        test: /\.js$/,&#10;        loader: &#39;babel-loader&#39;,&#10;        query: &#123;&#10;          presets: [&#39;es2015&#39;, &#39;react&#39;]&#10;        &#125;&#10;      &#125;&#10;    ]&#10;  &#125;,&#10;  resolve: &#123;&#10;    // you can now require(&#39;file&#39;) instead of require(&#39;file.coffee&#39;)&#10;    extensions: [&#39;&#39;, &#39;.js&#39;, &#39;.json&#39;, &#39;.coffee&#39;]&#10;  &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li>Stylesheets and images</li>
</ol>
<p>First update your code to require() your static assets (named as they would with node’s require()):</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require(&#39;./bootstrap.css&#39;);&#10;require(&#39;./myapp.less&#39;);&#10;&#10;var img = document.createElement(&#39;img&#39;);&#10;img.src = require(&#39;./glyph.png&#39;);</span><br></pre></td></tr></table></figure>
<p>When you require CSS (or less, etc), webpack inlines the CSS as a string inside the JS bundle and require() will insert a<style> tag into the page. When you require images, webpack inlines a URL to the image into the bundle and returns it from require().</p>
<p>But you need to teach webpack to do this (again, with loaders):</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// webpack.config.js&#10;module.exports = &#123;&#10;  entry: &#39;./main.js&#39;,&#10;  output: &#123;&#10;    path: &#39;./build&#39;, // This is where images AND js will go&#10;    publicPath: &#39;http://mycdn.com/&#39;, // This is used to generate URLs to e.g. images&#10;    filename: &#39;bundle.js&#39;&#10;  &#125;,&#10;  module: &#123;&#10;    loaders: [&#10;      &#123; test: /\.less$/, loader: &#39;style-loader!css-loader!less-loader&#39; &#125;, // use ! to chain loaders&#10;      &#123; test: /\.css$/, loader: &#39;style-loader!css-loader&#39; &#125;,&#10;      &#123;test: /\.(png|jpg)$/, loader: &#39;url-loader?limit=8192&#39;&#125; // inline base64 URLs for &#60;=8k images, direct URLs for the rest&#10;    ]&#10;  &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li>Feature flags</li>
</ol>
<p>We have code we want to gate only to our dev environments (like logging) and our internal dogfooding servers (like unreleased features we’re testing with employees). In your code, refer to magic globals:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if (__DEV__) &#123;&#10;  console.warn(&#39;Extra logging&#39;);&#10;&#125;&#10;// ...&#10;if (__PRERELEASE__) &#123;&#10;  showSecretFeature();&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>Then teach webpack those magic globals:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// webpack.config.js&#10;&#10;// definePlugin takes raw strings and inserts them, so you can put strings of JS if you want.&#10;var definePlugin = new webpack.DefinePlugin(&#123;&#10;  __DEV__: JSON.stringify(JSON.parse(process.env.BUILD_DEV || &#39;true&#39;)),&#10;  __PRERELEASE__: JSON.stringify(JSON.parse(process.env.BUILD_PRERELEASE || &#39;false&#39;))&#10;&#125;);&#10;&#10;module.exports = &#123;&#10;  entry: &#39;./main.js&#39;,&#10;  output: &#123;&#10;    filename: &#39;bundle.js&#39;&#10;  &#125;,&#10;  plugins: [definePlugin]&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>Then you can build with BUILD_DEV=1 BUILD_PRERELEASE=1 webpack from the console. Note that since webpack -p runs uglify dead-code elimination, anything wrapped in one of these blocks will be stripped out, so you won’t leak secret features or strings.</p>
<ol>
<li>Multiple entrypoints</li>
</ol>
<p>Let’s say you have a profile page and a feed page. You don’t want to make the user download the code for the feed if they just want the profile. So make multiple bundles: create one “main module” (called an entrypoint) per page:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// webpack.config.js&#10;module.exports = &#123;&#10;  entry: &#123;&#10;    Profile: &#39;./profile.js&#39;,&#10;    Feed: &#39;./feed.js&#39;&#10;  &#125;,&#10;  output: &#123;&#10;    path: &#39;build&#39;,&#10;    filename: &#39;[name].js&#39; // Template based on keys in entry above&#10;  &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>For profile, insert <script src="build/Profile.js"></script> into your page. Do a similar thing for feed.</p>
<ol>
<li>Optimizing common code</li>
</ol>
<p>Feed and Profile share a lot in common (like React and the common stylesheets and components). webpack can figure out what they have in common and make a shared bundle that can be cached between pages:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// webpack.config.js&#10;&#10;var webpack = require(&#39;webpack&#39;);&#10;&#10;var commonsPlugin =&#10;  new webpack.optimize.CommonsChunkPlugin(&#39;common.js&#39;);&#10;&#10;module.exports = &#123;&#10;  entry: &#123;&#10;    Profile: &#39;./profile.js&#39;,&#10;    Feed: &#39;./feed.js&#39;&#10;  &#125;,&#10;  output: &#123;&#10;    path: &#39;build&#39;,&#10;    filename: &#39;[name].js&#39; // Template based on keys in entry above&#10;  &#125;,&#10;  plugins: [commonsPlugin]&#10;&#125;;</span><br></pre></td></tr></table></figure>
<p>Add <script src="build/common.js"></script> before the script tag you added in the previous step and enjoy the free caching.</p>
<ol>
<li>Async loading</li>
</ol>
<p>CommonJS is synchronous but webpack provides a way to asynchronously specify dependencies. This is useful for client-side routers, where you want the router on every page, but you don’t want to have to download features until you actually need them.</p>
<p>Specify the split point where you want to load asynchronously. For example:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if (window.location.pathname === &#39;/feed&#39;) &#123;&#10;  showLoadingState();&#10;  require.ensure([], function() &#123; // this syntax is weird but it works&#10;    hideLoadingState();&#10;    require(&#39;./feed&#39;).show(); // when this function is called, the module is guaranteed to be synchronously available.&#10;  &#125;);&#10;&#125; else if (window.location.pathname === &#39;/profile&#39;) &#123;&#10;  showLoadingState();&#10;  require.ensure([], function() &#123;&#10;    hideLoadingState();&#10;    require(&#39;./profile&#39;).show();&#10;  &#125;);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>webpack will do the rest and generate extra chunk files and load them for you.</p>
<p>webpack will assume that those files are in your root directory when you load then into a html script tag for example. You can use output.publicPath to configure that.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// webpack.config.js&#10;output: &#123;&#10;    path: &#34;/home/proj/public/assets&#34;, //path to where webpack will build your stuff&#10;    publicPath: &#34;/assets/&#34; //path that will be considered when requiring your files&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>Additional resources</p>
<p>Take a look at a real world example on how a successful team is leveraging webpack: <a href="http://youtu.be/VkTCL6Nqm6Y">http://youtu.be/VkTCL6Nqm6Y</a> This is Pete Hunt at OSCon talking about webpack at Instagram.com</p>
<p>FAQ</p>
<p>webpack doesn’t seem modular</p>
<p>webpack is extremely modular. What makes webpack great is that it lets plugins inject themselves into more places in the build process when compared to alternatives like browserify and requirejs. Many things that may seem built into the core are just plugins that are loaded by default and can be overridden (i.e. the CommonJS require() parser).</p>
</style></p>
      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/02/01/本地端连接git/" rel="next" title="本地端连接git">
                <i class="fa fa-chevron-left"></i> 本地端连接git
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/02/01/webpack学习resources-3/"
           data-title="webpack学习resources-3" data-url="http://yoursite.com/2016/02/01/webpack学习resources-3/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/default_avatar.jpg"
               alt="tuluxmu" />
          <p class="site-author-name" itemprop="name">tuluxmu</p>
          <p class="site-description motion-element" itemprop="description">Front-end engineer。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">11</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/tuluxmu" target="_blank">
                  
                    <i class="fa fa-globe"></i> github
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tuluxmu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"your-duoshuo-shortname"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  

  
  


</body>
</html>
